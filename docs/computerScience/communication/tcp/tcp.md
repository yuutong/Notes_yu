
TCP（传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。

### 特点

- 有连接
- 传输可靠
- 传输字节流
- 传输效率慢
- 所需资源多

### 三次握手四次挥手

三次握手流程：

1. 客户端发送请求报文；`(SYN = 1, ACK = 0, seq = x)`
2. 服务器确认，服务器发送请求；`(SYN = 1, ACK = 1, seq = y)`
3. 客户端确认`(SYN = 0, ACK = 1, seq = x+1)`。此时，连接建立。

**为什么不是两次或四次握手？**

两次握手可能造成资源的浪费。如果没有第三次握手，服务器就不知道客户端是否收到了自己的回复，从而可能会对同一个请求重复创建连接。而三次握手连接建立之后，双方都会变为established状态，不会再对同一个客户端创建新的连接。四次握手则可以简化为三次。

四次挥手流程：

由于TCP是全双工通信，可以双向传输数据。任一方发送关闭连接请求并等对方确认后，单向连接将被关闭。为彻底终止双向传输，需要进行四次挥手。

### TCP连接如何确保可靠性

1. **数据块大小控制：**将数据分割成协议认为最合适发送的数据块。
2. **序列号：**发送方给每个数据包指定序列号，接收方根据序列号对数据包排序和去重复。
3. **校验和：**首部和数据的校验和用于检测数据在传输过程中的任何变化；如发生错误，则丢弃数据包。
4. **流量控制：**使用滑动窗口机制，确保发送方发送的数据不会溢出接收方的缓冲区。
5. **拥塞控制：**减少数据的发送来降低网络拥塞的风险。
6. **确认应答：**采用ARQ协议，发送一个分组后暂停，等待对方确认后再发送下一个分组。
7. **超时重传：**发送端发送数据包后启动定时器，超时未收到确认则重发数据。

### TCP拥塞控制的实现

1. **慢启动：**连接开始时从发送一个数据包开始，并以指数的速率增加发送的数据量。
2. **拥塞避免：**当发送窗口到达阈值后，发送方以线性速率增加数据发送量。
3. **超时重传：**发送端在超时后重发数据包。
4. **快速重传和快速恢复：**如果接收方收到重复确认，表明有数据包丢失；发送方无需等待计时器超时，立即重发丢失的数据包。
5. **拥塞窗口调整：**通过检测网络延迟和丢包率来调整发送速率，以减轻拥塞。

### 如何实现HTTP的多个TCP连接

多个TCP连接得以实现是通过服务器对"Connection: keep-alive"的Header进行支持。即在一个HTTP请求完成后，不断开该HTTP请求使用的TCP连接，以便这个连接可以被重新使用。这减少了重新建立TCP连接的需要，同时如果连接被保持，SSL的开销也可以避免。