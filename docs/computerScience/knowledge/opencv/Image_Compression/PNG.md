
PNG（可移植网络图形格式） 是一种常用的图像文件格式，主要用于在互联网上显示图像。<br>
PNG 支持无损压缩，这意味着图像在压缩和解压缩过程中不会丢失任何数据。

#### PNG 压缩算法

PNG 使用一种叫做 **DEFLATE** 的压缩算法，这是一个无损数据压缩算法，它结合了两种技术：

1. *LZ77（Lempel-Ziv 1977）*：一种基于滑动窗口的字符串匹配算法。<br>
2. *哈夫曼编码*：一种基于频率的编码技术。<br>


##### 1. LZ77压缩

LZ77 算法通过滑动窗口机制查找数据流中的重复模式，<br>
并将这些模式替换为指向之前出现位置的引用<br>

 *滑动窗口*：LZ77 使用一个固定大小的滑动窗口（通常是 32KB），在这个窗口中查找重复的字节序列<br>
 *查找匹配*：算法会在滑动窗口中查找与当前字节序列匹配的最长子串。<br>
 如果找到匹配，算法会记录匹配的位置和长度。<br>

 *输出引用*：匹配的子串会被替换为一个引用，<br>
 引用包含两个部分：匹配位置和匹配长度。<br>
 例如，如果在位置 100 处找到一个长度为 5 的匹配子串，引用可能表示为 `(100, 5)`<br>

*字面值（Literal）*：如果没有找到匹配的子串，当前字节会被作为字面值直接输出

##### 2. 哈夫曼编码

在 LZ77 压缩之后，得到的输出是由字面值和引用组成的混合数据流。<br>
接下来，DEFLATE 算法使用哈夫曼编码对这些数据进行编码。<br>

*统计频率*：算法会统计字面值和引用在数据流中出现的频率。<br>
*构建哈夫曼树*：根据出现频率构建哈夫曼树，<br>
频率高的字符（或引用）会分配较短的编码，频率低的字符会分配较长的编码。<br>

*编码数据*：使用哈夫曼树对字面值和引用进行编码，将它们转换为二进制编码。<br>

##### 结合LZ77和哈夫曼编码的过程

DEFLATE 算法结合 LZ77 和哈夫曼编码的过程可以分为以下几个步骤：

1. *滑动窗口查找匹配*：<br>
   - 使用 LZ77 算法在滑动窗口中查找重复的字节序列，并将匹配的子串替换为引用。<br>
   - 没有匹配的字节作为字面值直接输出。<br>

2. *生成混合数据流*：<br>
   - 得到一个包含字面值和引用的混合数据流。<br>

3. *统计频率*：<br>
   - 统计混合数据流中每个字面值和引用的出现频率。<br>

4. *构建哈夫曼树*：<br>
   - 根据频率构建哈夫曼树，频率高的字符（或引用）分配较短的编码，频率低的字符分配较长的编码。<br>

5. *编码数据*：<br>
   - 使用哈夫曼树对混合数据流进行编码，将字面值和引用转换为二进制编码。<br>

6. *输出压缩数据*：<br>
   - 将编码后的数据输出为压缩文件。<br>

##### 示例

假设我们有一个简单的数据流 "abcabcabc"：

1. *LZ77 压缩*：<br>
   滑动窗口查找匹配，发现 "abc" 重复了三次。<br>
   输出：`abc (0, 3) (0, 3)`<br>

2. *统计频率*：<br>
   字面值 "a", "b", "c" 各出现一次，引用 `(0, 3)` 出现两次。<br>

3. *构建哈夫曼树*：<br>
   根据频率构建哈夫曼树，假设 "a", "b", "c" 分配的编码为 `00`, `01`, `10`，引用 `(0, 3)` 分配的编码为 `11`。<br>

4. *编码数据*：<br>
   使用哈夫曼树对数据进行编码。<br>
   输出：`00 01 10 11 11`<br>

5. *输出压缩数据*：<br>
   编码后的数据 `00 01 10 11 11` 即为压缩文件。<br>

##### 总结

DEFLATE 算法通过结合 LZ77 和哈夫曼编码来实现数据压缩：<br>
- LZ77 负责查找并替换重复的模式，减少数据冗余。<br>
- 哈夫曼编码负责对数据进行编码，进一步压缩数据量。<br>


