“外参标定”就是在求解：

1. *相机坐标系* C 和 *世界坐标系*（比如标定板坐标系） W 之间的空间位姿关系；
2. 结果通常由一个 *旋转矩阵* R（3×3）和一个 *平移向量* t（3×1）来表示。

---

## 从 $\{R,t\}$ 到 4×4 齐次变换矩阵

为了方便把同一帧里、或者多帧之间的点云在不同坐标系之间转换，常把 $R$ 和 $t$ 组合成一个 **4×4 齐次变换矩阵** $T_{W\leftarrow C}$：


\begin{equation}
T_{W\leftarrow C} =
\begin{bmatrix}
R & t\[6pt]
\mathbf{0}{1\times3} & 1
\end{bmatrix}
=\begin{bmatrix}
r{11} & r_{12} & r_{13} & t_x\
r_{21} & r_{22} & r_{23} & t_y\
r_{31} & r_{32} & r_{33} & t_z\
0      & 0      & 0      & 1
\end{bmatrix}
\end{equation}



$$
T_{W\leftarrow C} \;=\;
\begin{bmatrix}
R & t\\[6pt]
\mathbf 0_{1\times3} & 1
\end{bmatrix}
=
\begin{bmatrix}
r_{11} & r_{12} & r_{13} & t_x\\
r_{21} & r_{22} & r_{23} & t_y\\
r_{31} & r_{32} & r_{33} & t_z\\
0      & 0      & 0      & 1
\end{bmatrix}
$$

* 上面第一行到第三行就是旋转和平移，第 4 行把它补齐为齐次形式。
* 任何相机坐标系下的点 $P_C=[x,y,z,1]^T$，都可以用

  $$
    P_W \;=\; T_{W\leftarrow C}\;P_C
  $$

  投影／变换到世界坐标系下。

---

## 外参标定的含义

* 当你用 `calibrateCamera` 或 `solvePnP` 求解出来的 $rvec$（Rodrigues 向量）和 $tvec$，其实就是在描述一个等价的 $R$ 和 $t$。
* 你可以这样将它们拼成 3×4，然后拓展为 4×4：

  ```cpp
  cv::Mat R;
  cv::Rodrigues(rvec, R);       // 3×3
  cv::Mat T = cv::Mat::eye(4,4,CV_64F);
  R.copyTo(T(cv::Rect(0,0,3,3)));
  tvec.copyTo(T(cv::Rect(3,0,1,3)));
  ```
* 这时 `T` 就是从相机到标定板（世界）的齐次变换矩阵。

---

### 小结

* **外参标定** 得到的是相机与世界（标定板）坐标系的刚性变换关系；
* 在实际工程里，常用 **4×4 齐次矩阵** 来统一表示和计算不同坐标系之间的变换。
* 后续多帧点云拼接，只要知道每一帧的 $T_{W\leftarrow C}$，就能把所有帧都变换到同一个世界坐标系下，拼成完整模型。


在 OpenCV 中，`rvec` 和 `tvec` 虽然都是 3×1 的向量，但它们分别对应下面两部分：

1. **`rvec`（Rodrigues 向量）→ 3×3 旋转矩阵 $R$**

   * `rvec` 本质上是**轴–角**（axis–angle）表示：

     * 它的方向（单位向量）是旋转轴，
     * 它的长度 $\|\mathbf r\|$ 是旋转角度 $\theta$（以弧度计）。
   * 通过 OpenCV 的 `cv::Rodrigues` 函数，就可以把这个 3×1 向量“展开”为一个正交的 3×3 旋转矩阵：

     ```cpp
     cv::Mat R;
     cv::Rodrigues(rvec, R);  // rvec: 3×1 → R: 3×3
     ```
   * **为什么要这样？**
     因为相比直接优化 9 个元素的 $R$，用 3 个参数的轴–角更紧凑、更容易在非线性优化中保持正交性。

2. **`tvec` → 3×1 平移向量 $\mathbf t$**

   * `tvec` 的 3 个分量 $(t_x, t_y, t_z)$ 就直接告诉你，**在旋转之后**，世界坐标系原点（比如棋盘格的原点）需要在相机坐标系里向 $t_x$、$t_y$、$t_z$ 移动多少，才能对准图像上的角点。

---

### 把 $R$ 和 $\mathbf t$ 组合成齐次变换

为了方便把三维点从相机坐标系 $C$ 转到世界／棋盘格坐标系 $W$，我们常把它们拼成一块 3×4，或者更常见的 4×4：

```cpp

// 假设 rvec, tvec 已经有了：
cv::Mat R;
cv::Rodrigues(rvec, R);          // R 是 3×3
// 构造 4×4 齐次矩阵
cv::Mat T = cv::Mat::eye(4, 4, CV_64F);
R.copyTo(T(cv::Rect(0, 0, 3, 3)));   // 左上 3×3 是 R
tvec.copyTo(T(cv::Rect(3, 0, 1, 3))); // 第 0–2 行，第 3 列是 tvec
// T = [ R | t ]
//     [ 0 | 1 ]

```

这样，对于相机坐标系下的点 $[X_c,Y_c,Z_c,1]^T$，你就可以做

$$
  [X_w,Y_w,Z_w,1]^T = T\, [X_c,Y_c,Z_c,1]^T
$$

完成坐标系变换。

---

### 小结

* **`rvec`** 看起来是 “1×3”，其实它压缩地承载了整张 $3×3$ 的旋转信息——你需要通过 `Rodrigues` 把它展开成正交矩阵R。
* **`tvec`** 就是一条从旋转后原点到相机原点的平移向量。
* 最终把二者拼起来，就得到了完整的刚性变换。

